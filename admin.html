<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ê–¥–º–∏–Ω–∫–∞ ‚Äî –ê—Å—ä—è–º–∞–Ω</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-asyaman.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="favicon-asyaman.png" />
  <link rel="apple-touch-icon" href="favicon-asyaman.png" />

  <!-- Description -->
  <meta name="description" content="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê—Å—ä—è–º–∞–Ω: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∂–µ–ª–∞–Ω–∏–π." />

  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --card-bg: rgba(17, 10, 32, 0.9);
      --card-border: rgba(255, 255, 255, 0.08);
      --accent: #ff4f9a;
      --accent-soft: #7f5bff;
      --accent-gold: #ffd56b;
      --accent-green: #4ade80;

      --text-main: #f7f4ff;
      --text-soft: rgba(232, 228, 255, 0.8);
      --text-muted: #9ca3af;
      --danger: #fb7185;

      --radius-xl: 32px;
      --radius-lg: 22px;
      --radius-md: 16px;

      --shadow-soft: 0 22px 70px rgba(0, 0, 0, 0.85);

      --transition-fast: 0.18s ease-out;
    }

    * {
      box-sizing: border-box;
    }

    *::before,
    *::after {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    html,
    body {
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      color: var(--text-main);
      background:
        radial-gradient(circle at 0% 0%, rgba(255, 79, 154, 0.22), transparent 55%),
        radial-gradient(circle at 100% 0%, rgba(127, 91, 255, 0.25), transparent 55%),
        radial-gradient(circle at 10% 120%, rgba(45, 212, 191, 0.28), transparent 60%),
        linear-gradient(145deg, #020617, #02010a 65%, #020617 100%);
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.55;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 160 160' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='2.2' numOctaves='3' stitchTiles='noStitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.22'/%3E%3C/svg%3E");
      mix-blend-mode: soft-light;
      z-index: -2;
    }

    .bg-orbit {
      position: fixed;
      border-radius: 999px;
      filter: blur(40px);
      opacity: 0.5;
      z-index: -3;
      pointer-events: none;
      mix-blend-mode: screen;
      animation: orbitPulse 10s ease-in-out infinite alternate;
    }

    .bg-orbit-1 {
      width: 420px;
      height: 420px;
      background: radial-gradient(circle, rgba(236, 72, 153, 0.8), transparent 70%);
      top: -80px;
      left: -120px;
    }

    .bg-orbit-2 {
      width: 520px;
      height: 520px;
      background: radial-gradient(circle, rgba(59, 130, 246, 0.8), transparent 70%);
      top: -60px;
      right: -160px;
      animation-delay: 2s;
    }

    .bg-orbit-3 {
      width: 580px;
      height: 580px;
      background: radial-gradient(circle, rgba(45, 212, 191, 0.7), transparent 70%);
      bottom: -160px;
      left: 10%;
      animation-delay: 4s;
    }

    @keyframes orbitPulse {
      from {
        transform: translate3d(0, 0, 0) scale(1);
      }
      to {
        transform: translate3d(0, -20px, 0) scale(1.08);
      }
    }

    ::-webkit-scrollbar {
      width: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.35);
      border-radius: 999px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    button {
      font-family: inherit;
    }

    .hidden {
      display: none !important;
    }

    /* HEADER */

    .site-header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(20px);
      background:
        radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(2, 6, 23, 0.92));
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
    }

    .header-inner {
      max-width: 1160px;
      margin: 0 auto;
      padding: 10px 18px 9px;
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }

    .brand-logo {
      width: 38px;
      height: 38px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 20% 0%, #f9a8d4, #4c1d95 60%, #020617 100%);
      border: 1px solid rgba(244, 114, 182, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 16px 30px rgba(15, 23, 42, 0.9);
      position: relative;
      overflow: hidden;
    }

    .brand-logo::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.3), transparent 45%);
      opacity: 0.55;
    }

    .brand-gem {
      width: 16px;
      height: 16px;
      border-radius: 40%;
      background: conic-gradient(from 200deg, #f97316, #22d3ee, #a855f7, #f97316);
      box-shadow: 0 0 14px rgba(248, 250, 252, 0.9);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .brand-title {
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.95rem;
    }

    .brand-subtitle {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .site-nav {
      flex: 1;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .nav-link {
      position: relative;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--text-soft);
      border: 1px solid rgba(30, 41, 59, 0.8);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.9));
      transition: background var(--transition-fast), color var(--transition-fast),
      border-color var(--transition-fast), transform var(--transition-fast),
      box-shadow var(--transition-fast);
    }

    .nav-link:hover {
      color: #ffffff;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.95), rgba(30, 64, 175, 0.9));
      border-color: rgba(148, 163, 184, 0.75);
      transform: translateY(-1px);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
    }

    .nav-link.nav-active {
      color: #ffffff;
      background: linear-gradient(120deg, #fb7185, #a855f7);
      border-color: transparent;
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.95);
    }

    .nav-link-soft {
      background: rgba(15, 23, 42, 0.82);
      border-color: rgba(148, 163, 184, 0.55);
    }

    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .icon-button {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      padding: 6px 9px;
      font-size: 0.9rem;
      background: radial-gradient(circle at top left, rgba(248, 250, 252, 0.04), rgba(15, 23, 42, 0.96));
      color: var(--text-main);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      transition: background var(--transition-fast), transform var(--transition-fast),
      box-shadow var(--transition-fast), border-color var(--transition-fast);
      backdrop-filter: blur(16px);
    }

    .icon-button:hover {
      border-color: rgba(248, 250, 252, 0.85);
      background: radial-gradient(circle at top, rgba(248, 250, 252, 0.12), rgba(15, 23, 42, 0.98));
      transform: translateY(-1px);
      box-shadow: 0 14px 40px rgba(15, 23, 42, 0.95);
    }

    /* MAIN LAYOUT */

    .page-main {
      max-width: 1160px;
      margin: 0 auto;
      padding: 24px 18px 40px;
    }

    .grid-main {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.3fr);
      gap: 22px;
      align-items: flex-start;
    }

    .card {
      border-radius: var(--radius-xl);
      background:
        linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(2, 6, 23, 0.98)),
        radial-gradient(circle at 0% 0%, rgba(248, 250, 252, 0.05), transparent 60%);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 20px 20px 18px;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(22px);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast),
      border-color var(--transition-fast), background var(--transition-fast);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.09), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(56, 189, 248, 0.12), transparent 55%),
        radial-gradient(circle at 50% 120%, rgba(244, 114, 182, 0.1), transparent 60%);
      opacity: 0.7;
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .card > * {
      position: relative;
      z-index: 1;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 26px 80px rgba(15, 23, 42, 0.98);
      border-color: rgba(248, 250, 252, 0.11);
    }

    .section-title {
      margin: 0 0 6px;
      font-size: 1.1rem;
    }

    .section-subtitle {
      margin: 0 0 10px;
      font-size: 0.86rem;
      color: var(--text-soft);
    }

    .badge {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 0.76rem;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.95);
    }

    .badge-green {
      border-color: rgba(74, 222, 128, 0.8);
      color: #bbf7d0;
    }

    .badge-red {
      border-color: rgba(248, 113, 113, 0.8);
      color: #fecaca;
    }

    .stats-row {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .stat-card {
      flex: 1;
      min-width: 120px;
      border-radius: 18px;
      padding: 10px 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.96);
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .stat-card strong {
      display: block;
      font-size: 1.2rem;
      color: #fef3c7;
      margin-bottom: 2px;
    }

    .stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .owner-info {
      margin-top: 14px;
      padding: 10px 12px;
      border-radius: 18px;
      border: 1px dashed rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .owner-info strong {
      color: #fee2e2;
    }

    /* TABLES */

    .table-block {
      margin-top: 8px;
      border-radius: 20px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.97);
      overflow: hidden;
    }

    .table-header {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.5);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: 0.84rem;
      color: var(--text-soft);
    }

    .table-header-title {
      font-weight: 500;
    }

    .table-inner {
      max-height: 280px;
      overflow: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    thead {
      position: sticky;
      top: 0;
      background: rgba(15, 23, 42, 0.98);
      z-index: 1;
    }

    th,
    td {
      padding: 7px 10px;
      text-align: left;
      border-bottom: 1px solid rgba(30, 41, 59, 0.9);
    }

    th {
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-size: 0.75rem;
    }

    tbody tr:hover {
      background: rgba(15, 23, 42, 0.98);
    }

    .table-empty {
      padding: 12px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .pill-small {
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 0.72rem;
    }

    .pill-owner {
      border-color: rgba(249, 115, 22, 0.8);
      color: #fed7aa;
    }

    .pill-user {
      border-color: rgba(148, 163, 184, 0.7);
      color: #e5e7eb;
    }

    .pill-danger {
      border-color: rgba(248, 113, 113, 0.8);
      color: #fecaca;
    }

    .filter-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .filter-input {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.98);
      color: var(--text-main);
      padding: 4px 9px;
      font-size: 0.78rem;
      outline: none;
    }

    .filter-input:focus {
      border-color: rgba(244, 114, 182, 0.9);
      box-shadow: 0 0 0 1px rgba(244, 114, 182, 0.7);
    }

    /* FOOTER */

    .page-footer {
      max-width: 1160px;
      margin: 0 auto;
      padding: 0 18px 24px;
      font-size: 0.8rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ACCESS DENIED */

    .denied-card {
      max-width: 640px;
      margin: 40px auto;
      text-align: center;
    }

    .denied-icon {
      font-size: 2.4rem;
      margin-bottom: 10px;
    }

    .denied-text {
      font-size: 0.9rem;
      color: var(--text-soft);
      margin-top: 6px;
    }

    /* ADAPTIVE */

    @media (max-width: 1024px) {
      .grid-main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 840px) {
      .header-inner {
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 10px 14px;
      }

      .site-nav {
        order: 2;
        justify-content: flex-start;
        overflow-x: auto;
        padding-bottom: 4px;
      }

      .card {
        border-radius: 24px;
        padding: 16px 16px 14px;
      }
    }

    @media (max-width: 520px) {
      .section-title {
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <!-- BG -->
  <div class="bg-orbit bg-orbit-1"></div>
  <div class="bg-orbit bg-orbit-2"></div>
  <div class="bg-orbit bg-orbit-3"></div>

  <!-- HEADER -->
  <header class="site-header">
    <div class="header-inner">
      <a href="index.html" class="brand">
        <div class="brand-logo">
          <div class="brand-gem"></div>
        </div>
        <div class="brand-text">
          <span class="brand-title">–ê—Å—ä—è–º–∞–Ω</span>
          <span class="brand-subtitle">–ø–∞–Ω–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞</span>
        </div>
      </a>

      <nav class="site-nav">
        <a href="index.html#wishes" class="nav-link">–ñ–µ–ª–∞–Ω–∏—è</a>
        <a href="index.html#thoughts" class="nav-link">–ú—ã—Å–ª–∏</a>
        <a href="index.html#miss" class="nav-link">–ö–æ–≥–¥–∞ —Å–∫—É—á–∞–µ—à—å</a>
        <a href="letter.html" class="nav-link">–ü–∏—Å—å–º–æ</a>
        <a href="about.html" class="nav-link">–û –Ω–∞—Å</a>
        <a href="admin.html" class="nav-link nav-active nav-link-soft">–ê–¥–º–∏–Ω–∫–∞</a>
      </nav>

      <div class="header-actions">
        <button id="backBtn" class="icon-button" type="button">
          ‚Üê –ù–∞–∑–∞–¥
        </button>
      </div>
    </div>
  </header>

  <!-- ACCESS WRAPPER -->
  <main class="page-main">
    <section id="access-denied" class="denied-card hidden">
      <div class="card">
        <div class="denied-icon">üîí</div>
        <h2 class="section-title">–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞</h2>
        <p class="section-subtitle">
          –¢—ã –≤–æ—à—ë–ª –Ω–µ –ø–æ–¥ —Ç–µ–º –∞–∫–∫–∞—É–Ω—Ç–æ–º. –ê–¥–º–∏–Ω–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å –∑–∞—Ä–∞–Ω–µ–µ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ
          –≤–ª–∞–¥–µ–ª—å—á–µ—Å–∫–æ–≥–æ UID –≤ Firebase.
        </p>
        <p class="denied-text">
          –ü—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω–∏—Å—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é, –≤—ã–π–¥–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –≤–æ–π–¥–∏ –ø–æ–¥ —Ç–µ–º –ª–æ–≥–∏–Ω–æ–º,
          –∫–æ—Ç–æ—Ä—ã–π –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ ¬´–æ—Å–Ω–æ–≤–Ω–æ–π¬ª.
        </p>
        <div style="margin-top: 16px; display:flex; justify-content:center; gap:8px; flex-wrap:wrap;">
          <button type="button" class="icon-button" onclick="window.location.href='index.html'">
            –ù–∞ –≥–ª–∞–≤–Ω—É—é
          </button>
        </div>
      </div>
    </section>

    <section id="admin-panel" class="grid-main hidden">
      <!-- LEFT: SUMMARY -->
      <article class="card">
        <h2 class="section-title">–û–±—â–∞—è –∫–∞—Ä—Ç–∏–Ω–∞</h2>
        <p class="section-subtitle">
          –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞—à —Å–∞–π—Ç: —Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π –∑–∞—Ö–æ–¥–∏–ª–æ, —Å–∫–æ–ª—å–∫–æ
          –∂–µ–ª–∞–Ω–∏–π —Å–æ–∑–¥–∞–Ω–æ –∏ –∫–∞–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏.
        </p>

        <div id="admin-status" class="badge badge-red">
          –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firestore‚Ä¶
        </div>

        <div class="stats-row">
          <div class="stat-card">
            <span class="stat-label">–í—Å–µ–≥–æ –∂–µ–ª–∞–Ω–∏–π</span>
            <strong id="statTotalWishes">0</strong>
            <span>–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ <code>wishes</code></span>
          </div>
          <div class="stat-card">
            <span class="stat-label">–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
            <strong id="statUsersCount">0</strong>
            <span>–ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</span>
          </div>
          <div class="stat-card">
            <span class="stat-label">–ñ–µ–ª–∞–Ω–∏–π —É –≤–ª–∞–¥–µ–ª—å—Ü–∞</span>
            <strong id="statOwnerWishes">0</strong>
            <span>–ø–æ —Ç–≤–æ–µ–º—É UID</span>
          </div>
        </div>

        <div class="owner-info">
          <strong>–¢–µ–∫—É—â–∏–π –∞–∫–∫–∞—É–Ω—Ç:</strong>
          <div id="currentOwnerInfo">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
          <p style="margin:8px 0 0;">
            –ï—Å–ª–∏ —Ç—ã –≤–∏–¥–∏—à—å —ç—Ç—É –ø–∞–Ω–µ–ª—å ‚Äî –∑–Ω–∞—á–∏—Ç, —Ç—ã –≤–æ—à—ë–ª –ø–æ–¥ —Ç–µ–º UID, –∫–æ—Ç–æ—Ä—ã–π –º—ã –¥–æ–±–∞–≤–∏–ª–∏
            –≤ —Å–ø–∏—Å–æ–∫ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤. –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å—é–¥–∞ –ø–æ–ø–∞—Å—Ç—å –Ω–µ —Å–º–æ–≥—É—Ç.
          </p>
        </div>
      </article>

      <!-- RIGHT: USERS TABLE -->
      <article class="card">
        <h2 class="section-title">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
        <p class="section-subtitle">
          –ù–∞ –æ—Å–Ω–æ–≤–µ –∂–µ–ª–∞–Ω–∏–π —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —á—Ç–æ-—Ç–æ
          –¥–æ–±–∞–≤–ª—è–ª–∏ –≤ –Ω–∞—à –º–∏—Ä.
        </p>

        <div class="table-block">
          <div class="table-header">
            <span class="table-header-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</span>
            <div class="filter-row">
              <span>–§–∏–ª—å—Ç—Ä –ø–æ email:</span>
              <input
                id="filterUsersInput"
                type="text"
                class="filter-input"
                placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: gmail.com"
              />
            </div>
          </div>
          <div class="table-inner">
            <table>
              <thead>
              <tr>
                <th>Email</th>
                <th>UID</th>
                <th>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</th>
                <th>–ñ–µ–ª–∞–Ω–∏–π</th>
                <th>–†–æ–ª—å</th>
              </tr>
              </thead>
              <tbody id="admin-users-body">
              <tr>
                <td colspan="5" class="table-empty">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π‚Ä¶</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </article>
    </section>

    <!-- SECOND ROW -->
    <section id="admin-panel-bottom" class="grid-main hidden" style="margin-top:22px;">
      <!-- WISHES TABLE -->
      <article class="card">
        <h2 class="section-title">–ñ–µ–ª–∞–Ω–∏—è</h2>
        <p class="section-subtitle">
          –¢—É—Ç –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∂–µ–ª–∞–Ω–∏—è –ø–æ–¥—Ä—è–¥: —Ç–µ–∫—Å—Ç, –∫—Ç–æ –¥–æ–±–∞–≤–∏–ª –∏ –∫–æ–≥–¥–∞.
        </p>

        <div class="table-block">
          <div class="table-header">
            <span class="table-header-title">–°–ø–∏—Å–æ–∫ –∂–µ–ª–∞–Ω–∏–π</span>
            <div class="filter-row">
              <span>–§–∏–ª—å—Ç—Ä –ø–æ —Ç–µ–∫—Å—Ç—É:</span>
              <input
                id="filterWishesInput"
                type="text"
                class="filter-input"
                placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–æ—Ñ–µ, –∫–∏–Ω–æ, –ø–æ–µ–∑–¥–∫–∞..."
              />
            </div>
          </div>
          <div class="table-inner">
            <table>
              <thead>
              <tr>
                <th>–¢–µ–∫—Å—Ç</th>
                <th>Email</th>
                <th>–î–∞—Ç–∞</th>
              </tr>
              </thead>
              <tbody id="admin-wishes-body">
              <tr>
                <td colspan="3" class="table-empty">–ó–∞–≥—Ä—É–∑–∫–∞ –∂–µ–ª–∞–Ω–∏–π‚Ä¶</td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </article>

      <!-- ACTIONS / DANGER ZONE (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
      <article class="card">
        <h2 class="section-title">–°–µ—Ä–≤–∏—Å–Ω–∞—è –∑–æ–Ω–∞</h2>
        <p class="section-subtitle">
          –¢—É—Ç —Ç–æ–ª—å–∫–æ –º—è–≥–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è ‚Äî –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª—è–µ–º –º–∞—Å—Å–æ–≤–æ, —á—Ç–æ–±—ã –Ω–µ —Å–ª–æ–º–∞—Ç—å
          –±–∞–∑—É. –ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å ¬´danger-–∑–æ–Ω—É¬ª —Å —á–∏—Å—Ç–∫–∞–º–∏ ‚Äî –¥–æ–±–∞–≤–∏–º –æ—Ç–¥–µ–ª—å–Ω–æ.
        </p>

        <div class="owner-info">
          <strong>–í–∞–∂–Ω–æ:</strong>
          <p style="margin:6px 0 0; font-size:0.8rem;">
            –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è —Å–µ–π—á–∞—Å –¥–µ–ª–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑ –∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—á–∏—Å—Ç–∫–∞
            –∂–µ–ª–∞–Ω–∏–π —É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–∞–π—Ç–µ). –í –∞–¥–º–∏–Ω–∫–µ –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä.
          </p>
        </div>

        <div style="margin-top:12px; display:flex; flex-direction:column; gap:8px; font-size:0.82rem;">
          <div>
            <span class="badge">–ò–¥–µ–∏ –Ω–∞ –±—É–¥—É—â–µ–µ:</span>
          </div>
          <ul style="padding-left:18px; margin:4px 0 0; color:var(--text-soft);">
            <li>–ö–Ω–æ–ø–∫–∞ ¬´—ç–∫—Å–ø–æ—Ä—Ç –∂–µ–ª–∞–Ω–∏–π¬ª –≤ CSV.</li>
            <li>–û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–≥—Ä–∞—Ñ–∏–∫–∏, –¥–∏–Ω–∞–º–∏–∫–∞).</li>
            <li>–§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ, –ø–æ—á—Ç–µ, –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º.</li>
          </ul>
        </div>
      </article>
    </section>
  </main>

  <footer class="page-footer">
    <span>–ê—Å—ä—è–º–∞–Ω ¬∑ –ø–∞–Ω–µ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞</span>
    <span>–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ Firestore (–∫–æ–ª–ª–µ–∫—Ü–∏—è <code>wishes</code>)</span>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import {
      getFirestore,
      collection,
      getDocs,
      query,
      orderBy,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCbgO8b96hAGU3kvwkjsv1x1Is-879Mbgc",
  authDomain: "asyaman-40f1f.firebaseapp.com",
  projectId: "asyaman-40f1f",
  storageBucket: "asyaman-40f1f.firebasestorage.app",
  messagingSenderId: "780594675672",
  appId: "1:780594675672:web:27766d673b4255a281bcad",
  measurementId: "G-LBMZLEY4Y5"
};

    // –°–ø–∏—Å–æ–∫ UID –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ (–º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω ‚Äî —Ç–≤–æ–π UID)
    const OWNER_UIDS = [QgveUKbsJLUOA3oehvXgTEbTg1S2
      "YOUR_OWNER_UID_HERE",
      // "SECOND_OWNER_UID_IF_NEEDED",
    ];

    // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM
    const accessDeniedSection = document.getElementById("access-denied");
    const adminPanel = document.getElementById("admin-panel");
    const adminPanelBottom = document.getElementById("admin-panel-bottom");
    const adminStatusEl = document.getElementById("admin-status");
    const usersBody = document.getElementById("admin-users-body");
    const wishesBody = document.getElementById("admin-wishes-body");
    const statTotalWishes = document.getElementById("statTotalWishes");
    const statUsersCount = document.getElementById("statUsersCount");
    const statOwnerWishes = document.getElementById("statOwnerWishes");
    const currentOwnerInfo = document.getElementById("currentOwnerInfo");
    const filterUsersInput = document.getElementById("filterUsersInput");
    const filterWishesInput = document.getElementById("filterWishesInput");

    let allWishes = [];
    let usersAgg = [];

    function isOwner(user) {
      if (!user) return false;
      return OWNER_UIDS.includes(user.uid);
    }

    function formatTimestamp(ts) {
      if (!ts) return "";
      try {
        const date = ts.toDate();
        return date.toLocaleString("ru-RU", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      } catch {
        return "";
      }
    }

    function setAdminStatus(message, ok = true) {
      if (!adminStatusEl) return;
      adminStatusEl.textContent = message;
      adminStatusEl.classList.toggle("badge-green", ok);
      adminStatusEl.classList.toggle("badge-red", !ok);
    }

    function renderUsersTable(filterText = "") {
      if (!usersBody) return;

      const q = (filterText || "").toLowerCase().trim();
      const filtered = q
        ? usersAgg.filter((u) => (u.email || "").toLowerCase().includes(q))
        : usersAgg;

      if (!filtered.length) {
        usersBody.innerHTML =
          '<tr><td colspan="5" class="table-empty">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ñ–∏–ª—å—Ç—Ä—É.</td></tr>';
        return;
      }

      usersBody.innerHTML = "";
      filtered.forEach((u) => {
        const tr = document.createElement("tr");

        const tdEmail = document.createElement("td");
        tdEmail.textContent = u.email || "‚Äî";

        const tdUid = document.createElement("td");
        tdUid.textContent = u.uid || "‚Äî";

        const tdLast = document.createElement("td");
        tdLast.textContent = u.lastLogin ? formatTimestamp(u.lastLogin) : "";

        const tdCount = document.createElement("td");
        tdCount.textContent = String(u.wishCount || 0);

        const tdRole = document.createElement("td");
        const span = document.createElement("span");
        span.className =
          "pill-small " + (OWNER_UIDS.includes(u.uid) ? "pill-owner" : "pill-user");
        span.textContent = OWNER_UIDS.includes(u.uid) ? "–í–ª–∞–¥–µ–ª–µ—Ü" : "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å";
        tdRole.appendChild(span);

        tr.appendChild(tdEmail);
        tr.appendChild(tdUid);
        tr.appendChild(tdLast);
        tr.appendChild(tdCount);
        tr.appendChild(tdRole);

        usersBody.appendChild(tr);
      });
    }

    function renderWishesTable(filterText = "") {
      if (!wishesBody) return;

      const q = (filterText || "").toLowerCase().trim();
      const filtered = q
        ? allWishes.filter((w) => (w.text || "").toLowerCase().includes(q))
        : allWishes;

      if (!filtered.length) {
        wishesBody.innerHTML =
          '<tr><td colspan="3" class="table-empty">–ù–µ—Ç –∂–µ–ª–∞–Ω–∏–π –ø–æ —Ç–µ–∫—É—â–µ–º—É —Ñ–∏–ª—å—Ç—Ä—É.</td></tr>';
        return;
      }

      wishesBody.innerHTML = "";
      filtered.forEach((w) => {
        const tr = document.createElement("tr");

        const tdText = document.createElement("td");
        tdText.textContent = w.text || "";

        const tdEmail = document.createElement("td");
        tdEmail.textContent = w.userEmail || "‚Äî";

        const tdDate = document.createElement("td");
        tdDate.textContent = w.createdAt ? formatTimestamp(w.createdAt) : "";

        tr.appendChild(tdText);
        tr.appendChild(tdEmail);
        tr.appendChild(tdDate);

        wishesBody.appendChild(tr);
      });
    }

    async function loadAdminData(currentUser) {
      try {
        setAdminStatus("–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Firestore‚Ä¶", true);

        const colRef = collection(db, "wishes");
        const qAll = query(colRef, orderBy("createdAt", "desc"));
        const snap = await getDocs(qAll);

        allWishes = snap.docs.map((d) => ({
          id: d.id,
          ...d.data(),
        }));

        // –°—Ç–∞—Ç—ã
        const totalWishes = allWishes.length;
        statTotalWishes.textContent = String(totalWishes);

        const usersMap = new Map();
        let ownerWishesCount = 0;

        allWishes.forEach((w) => {
          const key = w.userUid || w.userEmail || "unknown";
          if (!usersMap.has(key)) {
            usersMap.set(key, {
              email: w.userEmail || "‚Äî",
              uid: w.userUid || "‚Äî",
              lastLogin: w.createdAt || null,
              wishCount: 0,
            });
          }
          const obj = usersMap.get(key);
          obj.wishCount += 1;

          if (
            w.createdAt &&
            (!obj.lastLogin || w.createdAt.toMillis() > obj.lastLogin.toMillis())
          ) {
            obj.lastLogin = w.createdAt;
          }

          if (currentUser && w.userUid === currentUser.uid) {
            ownerWishesCount += 1;
          }
        });

        usersAgg = Array.from(usersMap.values());
        statUsersCount.textContent = String(usersAgg.length);
        statOwnerWishes.textContent = String(ownerWishesCount);

        renderUsersTable();
        renderWishesTable();

        setAdminStatus("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.", true);
      } catch (err) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–¥–º–∏–Ω-–¥–∞–Ω–Ω—ã—Ö:", err);
        setAdminStatus("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å.", false);

        if (usersBody) {
          usersBody.innerHTML =
            '<tr><td colspan="5" class="table-empty">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</td></tr>';
        }
        if (wishesBody) {
          wishesBody.innerHTML =
            '<tr><td colspan="3" class="table-empty">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∂–µ–ª–∞–Ω–∏–π.</td></tr>';
        }
      }
    }

    // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
    onAuthStateChanged(auth, (user) => {
      if (!user || !isOwner(user)) {
        if (accessDeniedSection) accessDeniedSection.classList.remove("hidden");
        if (adminPanel) adminPanel.classList.add("hidden");
        if (adminPanelBottom) adminPanelBottom.classList.add("hidden");
        if (currentOwnerInfo) {
          currentOwnerInfo.textContent = "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü.";
        }
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É
      if (accessDeniedSection) accessDeniedSection.classList.add("hidden");
      if (adminPanel) adminPanel.classList.remove("hidden");
      if (adminPanelBottom) adminPanelBottom.classList.remove("hidden");

      if (currentOwnerInfo) {
        currentOwnerInfo.textContent = `${user.email || "–±–µ–∑ –ø–æ—á—Ç—ã"} ¬∑ UID: ${
          user.uid
        }`;
      }

      loadAdminData(user);
    });

    // –§–∏–ª—å—Ç—Ä—ã
    if (filterUsersInput) {
      filterUsersInput.addEventListener("input", (e) => {
        renderUsersTable(e.target.value);
      });
    }

    if (filterWishesInput) {
      filterWishesInput.addEventListener("input", (e) => {
        renderWishesTable(e.target.value);
      });
    }

    // Back button
    const backBtn = document.getElementById("backBtn");
    if (backBtn) {
      backBtn.addEventListener("click", () => {
        if (window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = "index.html";
        }
      });
    }
  </script>
</body>
</html>
